{"version":3,"file":"chunk5.js","sources":["../../src/utils/ui-tether.ts"],"sourcesContent":["/**\n * @author    : Adarsh Pastakia\n * @version   : 5.0.0\n * @copyright : 2019\n * @license   : MIT\n */\n\nimport { Container, DOM } from \"aurelia-framework\";\nimport { getLogger } from \"aurelia-logging\";\nimport { UIAppConfig } from \"./ui-app-config\";\n\nexport namespace UITether {\n  export type Position = \"tl\" | \"tr\" | \"bl\" | \"br\" | \"tc\" | \"bc\" | \"cl\" | \"cr\";\n\n  export interface Tether {\n    dispose(): void;\n\n    updatePosition(newAnchor?: Element, newConfig?: TetherConfig): void;\n  }\n\n  export interface TetherConfig {\n    resize?: boolean;\n    attachToViewport?: boolean;\n    position?: Position;\n    anchorPosition?: Position;\n  }\n\n  export function tether(\n    anchorEl: Element,\n    dropdownEl: HTMLDivElement,\n    config: TetherConfig = Config\n  ) {\n    return attach(anchorEl, dropdownEl, { ...Config, ...config });\n  }\n\n  // Tether config\n  const Config: TetherConfig = {\n    anchorPosition: \"bl\",\n    attachToViewport: false,\n    position: \"tl\",\n    resize: true\n  };\n\n  // Tether functionality\n  const logger = getLogger(\"UITether\");\n\n  function updatePosition(\n    anchorEl: Element,\n    dropdownEl: HTMLDivElement,\n    scrollerEl: Element,\n    config\n  ) {\n    const anchorRect = anchorEl.getBoundingClientRect();\n    const dropdownRect = dropdownEl.getBoundingClientRect();\n    const scrollerRect = scrollerEl.getBoundingClientRect();\n\n    if (config.resize !== false) {\n      dropdownEl.style.minWidth = anchorRect.width + \"px\";\n    }\n\n    const [posY, posX] = config.position.split(\"\");\n    const [anchorY, anchorX] = config.anchorPosition.split(\"\");\n    const rtl = isRtl(scrollerEl);\n    let x = 0;\n    let y = 0;\n    let clientHeight = document.body.clientHeight;\n    let clientWidth = document.body.clientWidth;\n    let clientX = 0;\n    let clientY = 0;\n\n    logger.debug(\"tether\", {\n      rtl,\n      anchorRect,\n      anchorX,\n      anchorY,\n      dropdownRect,\n      posX,\n      posY\n    });\n\n    if (!config.attachToViewport) {\n      clientHeight = scrollerRect.bottom;\n      clientWidth = scrollerRect.right;\n      clientX = scrollerRect.left;\n      clientY = scrollerRect.top;\n    }\n\n    if (anchorX === (rtl ? \"r\" : \"l\")) {\n      x = anchorRect.left;\n    } else if (anchorX === (rtl ? \"l\" : \"r\")) {\n      x = anchorRect.right;\n    } else if (anchorX === \"c\") {\n      x = anchorRect.left + anchorRect.width / 2;\n    }\n    if (anchorY === \"t\") {\n      y = anchorRect.top;\n    } else if (anchorY === \"b\") {\n      y = anchorRect.bottom;\n    } else if (anchorY === \"c\") {\n      y = anchorRect.top + anchorRect.height / 2;\n    }\n\n    if (posX === (rtl ? \"l\" : \"r\")) {\n      x -= dropdownRect.width;\n    }\n    if (posX === \"c\") {\n      x -= dropdownRect.width / 2;\n    }\n    if (posY === \"b\") {\n      y -= dropdownRect.height;\n    }\n    if (posY === \"c\") {\n      y -= dropdownRect.height / 2;\n    }\n\n    logger.debug(\"tether2\", { x, y });\n\n    // TODO: Test it, i have no idea wtf i wrote\n    if (x + dropdownRect.width > clientWidth) {\n      x = anchorRect.right - dropdownRect.width;\n    } else if (x < clientX) {\n      x = anchorRect.left;\n    }\n\n    if (y + dropdownRect.height > clientHeight) {\n      y =\n        posY === \"t\" && anchorY === \"b\" ? anchorRect.top - dropdownRect.height - 2 : anchorRect.bottom;\n    } else if (y < clientY) {\n      y =\n        posY === \"b\" && anchorY === \"t\" ? anchorRect.bottom - dropdownRect.height : anchorRect.top;\n    }\n\n    logger.debug(\"tether3\", { x, y });\n\n    if (!config.attachToViewport) {\n      x -= scrollerRect.left - scrollerEl.scrollLeft + 2;\n      y -= scrollerRect.top - scrollerEl.scrollTop + 1;\n\n      logger.debug(\"tether4\", { x, y });\n\n      if (rtl && scrollerEl.scrollHeight > scrollerEl.offsetHeight) {\n        x -= 5;\n      }\n      logger.debug(\"tether5\", { x, y });\n    }\n    dropdownEl.style.transform = `translate(${x}px, ${y}px)`;\n  }\n\n  function scrollHandler(scrollCallbacks: Set<() => void> = new Set()) {\n    scrollCallbacks.forEach(c => c());\n  }\n\n  function getParentScroller(el) {\n    const styles = [\"scroll\", \"auto\"];\n    el = el.parentElement;\n    do {\n      const style = window.getComputedStyle(el);\n      if (\n        styles.includes(style.overflow) ||\n        styles.includes(style.overflowX) ||\n        styles.includes(style.overflowY)\n      ) {\n        return el;\n      }\n      el = el.parentElement;\n    } while (el !== null);\n    return null;\n  }\n\n  function initScroller(anchorEl: Element, scrollCallback) {\n    const scroller: Element & { scrollHandler?; scrollCallbacks?: Set<() => void> } =\n      getParentScroller(anchorEl) || document.body;\n\n    if (!scroller.scrollHandler) {\n      scroller.scrollHandler = () => scrollHandler(scroller.scrollCallbacks);\n      scroller.addEventListener(\"scroll\", scroller.scrollHandler);\n      scroller.scrollCallbacks = new Set();\n    }\n    scroller.scrollCallbacks.add(scrollCallback);\n    return scroller;\n  }\n\n  function attach(anchorEl: Element, dropdownEl: HTMLDivElement, config: TetherConfig) {\n    const container = Container.instance.get(UIAppConfig).FloatingContainer;\n    config.attachToViewport ? container.appendChild(dropdownEl.parentElement || dropdownEl) : fn();\n\n    let scroller;\n    const scrollCallback = () => {\n      if (dropdownEl.parentElement.dataset.open) {\n        updatePosition(anchorEl, dropdownEl, scroller, config);\n      }\n    };\n    scroller = initScroller(anchorEl, scrollCallback);\n\n    return {\n      dispose: () => {\n        scroller.scrollCallbacks.delete(scrollCallback);\n        if (dropdownEl.parentElement === Container.instance.get(UIAppConfig).FloatingContainer) {\n          DOM.removeNode(dropdownEl);\n        } else {\n          DOM.removeNode(dropdownEl.parentElement);\n        }\n      },\n      updatePosition: (newAnchorEl?: Element, newConfig = {}) => {\n        anchorEl = newAnchorEl || anchorEl;\n        scroller = initScroller(anchorEl, scrollCallback);\n        updatePosition(anchorEl, dropdownEl, scroller, { ...config, ...newConfig });\n      }\n    };\n  }\n}\n"],"names":[],"mappings":"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"}