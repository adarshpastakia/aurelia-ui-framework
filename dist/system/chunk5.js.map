{"version":3,"file":"chunk5.js","sources":["../../src/utils/ui-tether.ts"],"sourcesContent":["/**\n * @author    : Adarsh Pastakia\n * @version   : 5.0.0\n * @copyright : 2019\n * @license   : MIT\n */\n\nimport { Container, DOM } from \"aurelia-framework\";\nimport { getLogger } from \"aurelia-logging\";\nimport { UIAppConfig } from \"./ui-app-config\";\n\nexport namespace UITether {\n  export type Position = \"tl\" | \"tr\" | \"bl\" | \"br\" | \"tc\" | \"bc\" | \"cl\" | \"cr\";\n\n  export interface Tether {\n    dispose(): void;\n\n    updatePosition(newAnchor?: Element, newConfig?: TetherConfig): void;\n  }\n\n  export interface TetherConfig {\n    resize?: boolean;\n    attachToViewport?: boolean;\n    position?: Position;\n    anchorPosition?: Position;\n  }\n\n  export function tether(\n    anchorEl: Element,\n    dropdownEl: HTMLDivElement,\n    config: TetherConfig = Config\n  ) {\n    return attach(anchorEl, dropdownEl, { ...Config, ...config });\n  }\n\n  // Tether config\n  const Config: TetherConfig = {\n    anchorPosition: \"bl\",\n    attachToViewport: false,\n    position: \"tl\",\n    resize: true\n  };\n\n  // Tether functionality\n  const logger = getLogger(\"UITether\");\n\n  function updatePosition(\n    anchorEl: Element,\n    dropdownEl: HTMLDivElement,\n    scrollerEl: Element,\n    config\n  ) {\n    const anchorRect = anchorEl.getBoundingClientRect();\n    const dropdownRect = dropdownEl.getBoundingClientRect();\n    const scrollerRect = scrollerEl.getBoundingClientRect();\n\n    if (config.resize !== false) {\n      dropdownEl.style.minWidth = anchorRect.width + \"px\";\n    }\n\n    const [posY, posX] = config.position.split(\"\");\n    const [anchorY, anchorX] = config.anchorPosition.split(\"\");\n    const rtl = isRtl(scrollerEl);\n    let x = 0;\n    let y = 0;\n    let clientHeight = document.body.clientHeight;\n    let clientWidth = document.body.clientWidth;\n    let clientX = 0;\n    let clientY = 0;\n\n    logger.debug(\"tether\", {\n      rtl,\n      anchorRect,\n      anchorX,\n      anchorY,\n      dropdownRect,\n      posX,\n      posY\n    });\n\n    if (!config.attachToViewport) {\n      clientHeight = scrollerRect.bottom;\n      clientWidth = scrollerRect.right;\n      clientX = scrollerRect.left;\n      clientY = scrollerRect.top;\n    }\n\n    if (anchorX === (rtl ? \"r\" : \"l\")) {\n      x = anchorRect.left;\n    } else if (anchorX === (rtl ? \"l\" : \"r\")) {\n      x = anchorRect.right;\n    } else if (anchorX === \"c\") {\n      x = anchorRect.left + anchorRect.width / 2;\n    }\n    if (anchorY === \"t\") {\n      y = anchorRect.top;\n    } else if (anchorY === \"b\") {\n      y = anchorRect.bottom;\n    } else if (anchorY === \"c\") {\n      y = anchorRect.top + anchorRect.height / 2;\n    }\n\n    if (posX === (rtl ? \"l\" : \"r\")) {\n      x -= dropdownRect.width;\n    }\n    if (posX === \"c\") {\n      x -= dropdownRect.width / 2;\n    }\n    if (posY === \"b\") {\n      y -= dropdownRect.height;\n    }\n    if (posY === \"c\") {\n      y -= dropdownRect.height / 2;\n    }\n\n    logger.debug(\"tether2\", { x, y });\n\n    // TODO: Test it, i have no idea wtf i wrote\n    if (x + dropdownRect.width > clientWidth) {\n      x = anchorRect.right - dropdownRect.width;\n    } else if (x < clientX) {\n      x = anchorRect.left;\n    }\n\n    if (y + dropdownRect.height > clientHeight) {\n      y =\n        posY === \"t\" && anchorY === \"b\" ? anchorRect.top - dropdownRect.height - 2 : anchorRect.bottom;\n    } else if (y < clientY) {\n      y =\n        posY === \"b\" && anchorY === \"t\" ? anchorRect.bottom - dropdownRect.height : anchorRect.top;\n    }\n\n    logger.debug(\"tether3\", { x, y });\n\n    if (!config.attachToViewport) {\n      x -= scrollerRect.left - scrollerEl.scrollLeft + 2;\n      y -= scrollerRect.top - scrollerEl.scrollTop + 1;\n\n      logger.debug(\"tether4\", { x, y });\n\n      if (rtl && scrollerEl.scrollHeight > scrollerEl.offsetHeight) {\n        x -= 5;\n      }\n      logger.debug(\"tether5\", { x, y });\n    }\n    dropdownEl.style.transform = `translate(${x}px, ${y}px)`;\n  }\n\n  function scrollHandler(scrollCallbacks: Set<() => void> = new Set()) {\n    scrollCallbacks.forEach(c => c());\n  }\n\n  function getParentScroller(el) {\n    const styles = [\"scroll\", \"auto\"];\n    el = el.parentElement;\n    do {\n      const style = window.getComputedStyle(el);\n      if (\n        styles.includes(style.overflow) ||\n        styles.includes(style.overflowX) ||\n        styles.includes(style.overflowY)\n      ) {\n        return el;\n      }\n      el = el.parentElement;\n    } while (el !== null);\n    return null;\n  }\n\n  function initScroller(anchorEl: Element, scrollCallback) {\n    const scroller: Element & { scrollHandler?; scrollCallbacks?: Set<() => void> } =\n      getParentScroller(anchorEl) || document.body;\n\n    if (!scroller.scrollHandler) {\n      scroller.scrollHandler = () => scrollHandler(scroller.scrollCallbacks);\n      scroller.addEventListener(\"scroll\", scroller.scrollHandler);\n      scroller.scrollCallbacks = new Set();\n    }\n    scroller.scrollCallbacks.add(scrollCallback);\n    return scroller;\n  }\n\n  function attach(anchorEl: Element, dropdownEl: HTMLDivElement, config: TetherConfig) {\n    const container = Container.instance.get(UIAppConfig).FloatingContainer;\n    config.attachToViewport ? container.appendChild(dropdownEl.parentElement || dropdownEl) : fn();\n\n    let scroller;\n    const scrollCallback = () => {\n      if (dropdownEl.parentElement.dataset.open) {\n        updatePosition(anchorEl, dropdownEl, scroller, config);\n      }\n    };\n    scroller = initScroller(anchorEl, scrollCallback);\n\n    return {\n      dispose: () => {\n        scroller.scrollCallbacks.delete(scrollCallback);\n        if (dropdownEl.parentElement === Container.instance.get(UIAppConfig).FloatingContainer) {\n          DOM.removeNode(dropdownEl);\n        } else {\n          DOM.removeNode(dropdownEl.parentElement);\n        }\n      },\n      updatePosition: (newAnchorEl?: Element, newConfig = {}) => {\n        anchorEl = newAnchorEl || anchorEl;\n        scroller = initScroller(anchorEl, scrollCallback);\n        updatePosition(anchorEl, dropdownEl, scroller, { ...config, ...newConfig });\n      }\n    };\n  }\n}\n"],"names":[],"mappings":"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"}