{"version":3,"file":"chunk5.js","sources":["../../src/utils/ui-tether.ts"],"sourcesContent":["/**\n * @author    : Adarsh Pastakia\n * @version   : 5.0.0\n * @copyright : 2019\n * @license   : MIT\n */\n\nimport { Container, DOM } from \"aurelia-framework\";\nimport { getLogger } from \"aurelia-logging\";\nimport { UIAppConfig } from \"./ui-app-config\";\n\nexport namespace UITether {\n  export type Position = \"tl\" | \"tr\" | \"bl\" | \"br\" | \"tc\" | \"bc\" | \"cl\" | \"cr\";\n\n  export interface Tether {\n    dispose(): void;\n\n    updatePosition(newAnchor?: Element, newConfig?: TetherConfig): void;\n  }\n\n  export interface TetherConfig {\n    resize?: boolean;\n    attachToViewport?: boolean;\n    position?: Position;\n    anchorPosition?: Position;\n  }\n\n  export function tether(\n    anchorEl: Element,\n    dropdownEl: HTMLDivElement,\n    config: TetherConfig = Config\n  ) {\n    return attach(anchorEl, dropdownEl, { ...Config, ...config });\n  }\n\n  // Tether config\n  const Config: TetherConfig = {\n    anchorPosition: \"bl\",\n    attachToViewport: false,\n    position: \"tl\",\n    resize: true\n  };\n\n  // Tether functionality\n  const logger = getLogger(\"UITether\");\n\n  function updatePosition(\n    anchorEl: Element,\n    dropdownEl: HTMLDivElement,\n    scrollerEl: Element,\n    config\n  ) {\n    const anchorRect = anchorEl.getBoundingClientRect();\n    const dropdownRect = dropdownEl.getBoundingClientRect();\n    const scrollerRect = scrollerEl.getBoundingClientRect();\n\n    if (config.resize !== false) {\n      dropdownEl.style.minWidth = anchorRect.width + \"px\";\n    }\n\n    const [posY, posX] = config.position.split(\"\");\n    const [anchorY, anchorX] = config.anchorPosition.split(\"\");\n    const rtl = isRtl(scrollerEl);\n    let x = 0;\n    let y = 0;\n    let clientHeight = document.body.clientHeight;\n    let clientWidth = document.body.clientWidth;\n    let clientX = 0;\n    let clientY = 0;\n\n    logger.debug(\"tether\", {\n      rtl,\n      anchorRect,\n      anchorX,\n      anchorY,\n      dropdownRect,\n      posX,\n      posY\n    });\n\n    if (!config.attachToViewport) {\n      clientHeight = scrollerRect.bottom;\n      clientWidth = scrollerRect.right;\n      clientX = scrollerRect.left;\n      clientY = scrollerRect.top;\n    }\n\n    if (anchorX === (rtl ? \"r\" : \"l\")) {\n      x = anchorRect.left;\n    } else if (anchorX === (rtl ? \"l\" : \"r\")) {\n      x = anchorRect.right;\n    } else if (anchorX === \"c\") {\n      x = anchorRect.left + anchorRect.width / 2;\n    }\n    if (anchorY === \"t\") {\n      y = anchorRect.top;\n    } else if (anchorY === \"b\") {\n      y = anchorRect.bottom;\n    } else if (anchorY === \"c\") {\n      y = anchorRect.top + anchorRect.height / 2;\n    }\n\n    if (posX === (rtl ? \"l\" : \"r\")) {\n      x -= dropdownRect.width;\n    }\n    if (posX === \"c\") {\n      x -= dropdownRect.width / 2;\n    }\n    if (posY === \"b\") {\n      y -= dropdownRect.height;\n    }\n    if (posY === \"c\") {\n      y -= dropdownRect.height / 2;\n    }\n\n    logger.debug(\"tether2\", { x, y });\n\n    // TODO: Test it, i have no idea wtf i wrote\n    if (x + dropdownRect.width > clientWidth) {\n      x = anchorRect.right - dropdownRect.width;\n    } else if (x < clientX) {\n      x = anchorRect.left;\n    }\n\n    if (y + dropdownRect.height > clientHeight) {\n      y =\n        posY === \"t\" && anchorY === \"b\" ? anchorRect.top - dropdownRect.height - 2 : anchorRect.bottom;\n    } else if (y < clientY) {\n      y =\n        posY === \"b\" && anchorY === \"t\" ? anchorRect.bottom - dropdownRect.height : anchorRect.top;\n    }\n\n    logger.debug(\"tether3\", { x, y });\n\n    if (!config.attachToViewport) {\n      x -= scrollerRect.left - scrollerEl.scrollLeft + 2;\n      y -= scrollerRect.top - scrollerEl.scrollTop + 1;\n\n      logger.debug(\"tether4\", { x, y });\n\n      if (rtl && scrollerEl.scrollHeight > scrollerEl.offsetHeight) {\n        x -= 5;\n      }\n      logger.debug(\"tether5\", { x, y });\n    }\n    dropdownEl.style.transform = `translate(${x}px, ${y}px)`;\n  }\n\n  function scrollHandler(scrollCallbacks: Set<() => void> = new Set()) {\n    scrollCallbacks.forEach(c => c());\n  }\n\n  function getParentScroller(el) {\n    const styles = [\"scroll\", \"auto\"];\n    el = el.parentElement;\n    do {\n      const style = window.getComputedStyle(el);\n      if (\n        styles.includes(style.overflow) ||\n        styles.includes(style.overflowX) ||\n        styles.includes(style.overflowY)\n      ) {\n        return el;\n      }\n      el = el.parentElement;\n    } while (el !== null);\n    return null;\n  }\n\n  function initScroller(anchorEl: Element, scrollCallback) {\n    const scroller: Element & { scrollHandler?; scrollCallbacks?: Set<() => void> } =\n      getParentScroller(anchorEl) || document.body;\n\n    if (!scroller.scrollHandler) {\n      scroller.scrollHandler = () => scrollHandler(scroller.scrollCallbacks);\n      scroller.addEventListener(\"scroll\", scroller.scrollHandler);\n      scroller.scrollCallbacks = new Set();\n    }\n    scroller.scrollCallbacks.add(scrollCallback);\n    return scroller;\n  }\n\n  function attach(anchorEl: Element, dropdownEl: HTMLDivElement, config: TetherConfig) {\n    const container = Container.instance.get(UIAppConfig).FloatingContainer;\n    config.attachToViewport ? container.appendChild(dropdownEl.parentElement || dropdownEl) : fn();\n\n    let scroller;\n    const scrollCallback = () => {\n      if (dropdownEl.parentElement.dataset.open) {\n        updatePosition(anchorEl, dropdownEl, scroller, config);\n      }\n    };\n    scroller = initScroller(anchorEl, scrollCallback);\n\n    return {\n      dispose: () => {\n        scroller.scrollCallbacks.delete(scrollCallback);\n        if (dropdownEl.parentElement === Container.instance.get(UIAppConfig).FloatingContainer) {\n          DOM.removeNode(dropdownEl);\n        } else {\n          DOM.removeNode(dropdownEl.parentElement);\n        }\n      },\n      updatePosition: (newAnchorEl?: Element, newConfig = {}) => {\n        anchorEl = newAnchorEl || anchorEl;\n        scroller = initScroller(anchorEl, scrollCallback);\n        updatePosition(anchorEl, dropdownEl, scroller, { ...config, ...newConfig });\n      }\n    };\n  }\n}\n"],"names":["getLogger","Container","UIAppConfig","DOM","UITether"],"mappings":"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"}